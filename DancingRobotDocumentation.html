<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_e7258wzbzwzz-7.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-7 0}.lst-kix_e7258wzbzwzz-3>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-3}ol.lst-kix_e7258wzbzwzz-2.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-2 0}ol.lst-kix_e7258wzbzwzz-0.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-0 0}ol.lst-kix_e7258wzbzwzz-5.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-5 0}.lst-kix_e7258wzbzwzz-6>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-6,decimal) ". "}.lst-kix_e7258wzbzwzz-5>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-5,lower-roman) ". "}.lst-kix_e7258wzbzwzz-6>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-6}.lst-kix_e7258wzbzwzz-1>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-1}ol.lst-kix_e7258wzbzwzz-4.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-4 0}.lst-kix_e7258wzbzwzz-4>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-4}.lst-kix_e7258wzbzwzz-7>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-7}.lst-kix_e7258wzbzwzz-7>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-7,lower-latin) ". "}.lst-kix_e7258wzbzwzz-0>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-0}.lst-kix_e7258wzbzwzz-8>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-8,lower-roman) ". "}ol.lst-kix_e7258wzbzwzz-6{list-style-type:none}ol.lst-kix_e7258wzbzwzz-7{list-style-type:none}ol.lst-kix_e7258wzbzwzz-8{list-style-type:none}ol.lst-kix_e7258wzbzwzz-0{list-style-type:none}ol.lst-kix_e7258wzbzwzz-1{list-style-type:none}ol.lst-kix_e7258wzbzwzz-6.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-6 0}ol.lst-kix_e7258wzbzwzz-2{list-style-type:none}ol.lst-kix_e7258wzbzwzz-3{list-style-type:none}ol.lst-kix_e7258wzbzwzz-4{list-style-type:none}ol.lst-kix_e7258wzbzwzz-1.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-1 0}ol.lst-kix_e7258wzbzwzz-5{list-style-type:none}.lst-kix_e7258wzbzwzz-3>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-3,decimal) ". "}.lst-kix_e7258wzbzwzz-2>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-2,lower-roman) ". "}.lst-kix_e7258wzbzwzz-4>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-4,lower-latin) ". "}.lst-kix_e7258wzbzwzz-5>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-5}.lst-kix_e7258wzbzwzz-8>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-8}.lst-kix_e7258wzbzwzz-0>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-0,decimal) ". "}.lst-kix_e7258wzbzwzz-2>li{counter-increment:lst-ctn-kix_e7258wzbzwzz-2}.lst-kix_e7258wzbzwzz-1>li:before{content:"" counter(lst-ctn-kix_e7258wzbzwzz-1,lower-latin) ". "}ol.lst-kix_e7258wzbzwzz-3.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-3 0}ol.lst-kix_e7258wzbzwzz-8.start{counter-reset:lst-ctn-kix_e7258wzbzwzz-8 0}ol{margin:0;padding:0}table td,table th{padding:0}.c19{-webkit-text-decoration-skip:none;color:#000000;font-weight:700;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:11pt;font-family:"Arial";font-style:normal}.c5{-webkit-text-decoration-skip:none;color:#000000;font-weight:700;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Arial";font-style:normal}.c20{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Times New Roman";font-style:normal}.c23{color:#999999;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c18{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c10{color:#93c47d;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c16{font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c21{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:right}.c11{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c22{background-color:#f5f5f5;font-size:12pt;color:#282828}.c14{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c9{margin-left:36pt;padding-left:0pt}.c8{color:inherit;text-decoration:inherit}.c13{padding:0;margin:0}.c17{color:#6aa84f}.c12{color:#9900ff}.c15{color:#6d9eeb}.c6{height:11pt}.c3{vertical-align:sub}.c4{text-indent:36pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c14"><p class="c1"><span class="c5">Designers</span></p><p class="c1"><span class="c2">Tabi Silver</span></p><p class="c1"><span class="c2">Jocelyn Shiue</span></p><p class="c1"><span class="c2">Jean Huang</span></p><p class="c1"><span class="c2">Under the guidance of James Battat. </span></p><p class="c1"><span class="c2">With the help of Amy Banzaert, Dave Barrett, and Larry Knowles.</span></p><p class="c1 c6"><span class="c20"></span></p><p class="c1 c6"><span class="c20"></span></p><p class="c1"><span class="c5">Project Description</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: -0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 411.00px;"><img alt="" src="images/image3.png" style="width: 624.00px; height: 468.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2">We built a dancing narwhal that utilizes an analog low-pass filter for beat detection. Beat detection input is initially gathered by a microphone, whose millivolt signal is re-centered around 1.5 V and amplified to fill the 0~4 V range before reaching the Arduino Uno. Movement is provided by 6 servos, 4 below and 2 above a mobile platform: the lower servos provide vertical bopping and twisting motions and the upper servos in conjunction with a 3D-printed joystick provide side-to-side and forward-to-backward rocking motions. </span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span>This project was inspired by the </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=http://hackedgadgets.com/2007/05/12/keepon-interaction-robot/&amp;sa=D&amp;ust=1538149707828000">Keepon Interaction Robot</a></span><span>&nbsp;but designed as a budget-friendly alternative that does not involve color CCD cameras or isolated degrees of freedom for motion. As GoogleDocs is incapable of embedding videos, follow the links for video footage of the Dancing Narwhal in action to </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=https://drive.google.com/file/d/1wT9AU9BOb4FNnWL8drw-6Y8vV8Q_eiHr/view?usp%3Dsharing&amp;sa=D&amp;ust=1538149707829000">a metronome at 60bpm</a></span><span>&nbsp;and </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=https://drive.google.com/file/d/1axfPUlJRtLbN8Afj4aEk1b8CxvxzGM91/view?usp%3Dsharing&amp;sa=D&amp;ust=1538149707829000">an EDM beat</a></span><span class="c2">.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c5">Parts List</span></p><p class="c1"><span class="c11"><a class="c8" href="https://www.google.com/url?q=https://docs.google.com/spreadsheets/d/1dPhJONiIlOeWQd743ps2o8NfRmKt0imZAqSkSL3BILo/edit?usp%3Dsharing&amp;sa=D&amp;ust=1538149707830000">Materials used</a></span><span class="c2">&nbsp;amounts to a total budget of $57.40. This budget does not include the purchase price of the tools used, including:</span></p><ol class="c13 lst-kix_e7258wzbzwzz-0 start" start="1"><li class="c1 c9"><span class="c2">Foam cutter </span></li><li class="c1 c9"><span class="c2">Drill press</span></li><li class="c1 c9"><span class="c2">Table Saw</span></li><li class="c1 c9"><span class="c2">Sander</span></li><li class="c1 c9"><span class="c2">Tap and driver </span></li><li class="c1 c9"><span class="c2">Laser Printer</span></li><li class="c1 c9"><span class="c2">Frequency generator</span></li><li class="c1 c9"><span class="c2">BNC cords (2) and wire clip to BNC connectors</span></li><li class="c1 c9"><span class="c2">Screw cutters</span></li><li class="c1 c9"><span class="c2">Oscilloscope</span></li><li class="c1 c9"><span class="c2">Hot glue gun</span></li></ol><p class="c1 c6"><span class="c2"></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c5">Project Construction </span></p><p class="c1"><span>There are three main components to the construction of this dancing robot (accentuated in the block diagram below): </span><span class="c17">A) audio signal input</span><span>, </span><span class="c15">B) beat detection to pulse formation</span><span>, </span><span class="c12">C) structural design</span><span class="c2">.</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="" src="images/image7.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c10">Component A: Audio Signal Input</span></p><p class="c1"><span class="c2">Although not included in the Parts List, an oscilloscope is helpful for troubleshooting microphone circuitry. The mini-grabbers for the oscilloscope input channels will show up in the circuit images throughout this section.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">The basic circuitry interacts with the sound input in three sections before sending the audio signal to the Arduino Uno:</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c21"><span class="c23">circuit diagram source: PHYS 310 Electronics Lab 9</span></p><p class="c1"><span class="c2">To avoid damaging any hardware, disconnect the power source when tweaking circuitry.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c10">Component A-i: Sound Input</span></p><p class="c1"><span class="c2">Pretty straight forward connection of the positive terminal of the microphone to the voltage source through a 2.2k&#8486; resistor and then the negative terminal of the microphone to ground. The microphone terminal that is marked by three radiating lines is the ground terminal. The 2.2k&#8486; resistor does not serve the purpose of preventing a surge of current to the microphone. The microphone itself is equipped with a field effect transistor that is able to serve this purpose by buffering the microphone with high input impedence. Instead, the 2.2k&#8486; resistor is a pull-up resistor - it ensures that the voltage is well-defined at +5V even during silence. What comes out of the microphone in response to our audio signal is an AC signal on the mV scale. You can check this with an oscilloscope.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c10">Component A-ii: Level Shift</span></p><p class="c1"><span>As mentioned at the end of the previous section, the microphone produces a mV scale AC signal superimposed on top of a +5V DC output. The level shift component is inherently a high pass filter as its goal is to block the large DC voltage from the microphone but pass the (higher frequency) audio signal. The ratio of R</span><span class="c3">1</span><span>&nbsp;and R</span><span class="c3">2</span><span class="c2">&nbsp;as a divider determines how large of a DC offset is applied to the audio signal. For reasons to be explained in &ldquo;Component A-iii: Signal Amplification,&rdquo; we want to apply a DC offset of ~2V to the audio signal. </span></p><p class="c0"><img src="images/image1.png"><span class="c7">V</span></p><p class="c1"><span>Specifically for our beat detection purposes, a further restriction is placed on R</span><span class="c3">1</span><span>&nbsp;and R</span><span class="c3">2 </span><span>(and C): most song tempos are set within the range of 100~180bpm, which in turn corresponds to a frequency range of 1.7~3.0Hz. To prevent losing this information, we must determine R</span><span class="c3">1</span><span>, R</span><span class="c3">2</span><span class="c2">, and C with a low cutoff frequency (like 1Hz) in mind.</span></p><p class="c0"><img src="images/image2.png"><span class="c7">Hz</span></p><p class="c1"><span>We went with C=10&micro;F, R</span><span class="c3">1</span><span>=560k&#8486;, and R</span><span class="c3">2</span><span>=220k&#8486; for a f</span><span class="c3">c</span><span>~1.5Hz and a V</span><span class="c3">out</span><span>~1.4V. Keep in mind that R=R</span><span class="c3">1</span><span>||R</span><span class="c3">2</span><span class="c2">&nbsp;for a divider. </span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">To check your work, wire up the oscilloscope as follows (red mini-grabber to the top of the image connects to CH1 on the oscilloscope vs. that to the right of the image connects to CH2 on the oscilloscope): </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 622.34px; height: 466.50px;"><img alt="" src="images/image11.jpg" style="width: 622.34px; height: 466.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2">The yellow signal of CH1 should correspond to the output of the microphone (CH1 set to AC coupling, 10.0mV scale). The blue signal of CH2 should reflect the microphone output after applying level shift. All oscilloscope traces shown in this documentation correspond to a 60bpm metronome input signal.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 492.50px; height: 369.38px;"><img alt="" src="images/image10.jpg" style="width: 492.50px; height: 369.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2">In the image above, CH2 is set at AC coupling and 10.0mV scale to match the settings of CH1. The signals have been vertically staggered for clarity and the signals look no different from each other. We chose to include this image due to the limited range of the oscilloscope&rsquo;s y-axis which will become clear in the next image where we try to emphasize the effect of the level shift.</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 499.33px; height: 374.50px;"><img alt="" src="images/image13.jpg" style="width: 499.33px; height: 374.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2">The parameters for CH1 remain the same but CH2 is now set to DC coupling and on the 500mV scale. Both signals are now zeroed at the same point. Due to the larger scale, the beat pattern is not visible on CH2. However, we can confirm successful DC offset of ~1.25V. </span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c10">Component A-iii: Signal Amplification</span></p><p class="c1"><span class="c2">An operational amplifier can be used to amplify the mV offset output to span a V scale range. The &lsquo;358 op amp is a single-supply op amp and when powering it with +5V supply, its operating range is more or less 0~4V. The potentiometer allows for adjusting the gain of the amplifier by the turn of a knob as opposed to replacing resistors. </span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">Check for proper wiring and functionality by hooking up the oscilloscope as below (CH1 still microphone output but CH2 is now op amp output):</span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 468.00px;"><img alt="" src="images/image14.jpg" style="width: 624.00px; height: 468.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">Signal with maximum gain:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 490.50px; height: 367.88px;"><img alt="" src="images/image15.jpg" style="width: 490.50px; height: 367.88px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">Signal with minimum gain: </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 487.50px; height: 365.63px;"><img alt="" src="images/image9.jpg" style="width: 487.50px; height: 365.63px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">Some amount of gain in between the extrema: </span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 484.50px; height: 363.38px;"><img alt="" src="images/image4.jpg" style="width: 484.50px; height: 363.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c10">Optional Enhancements:</span></p><p class="c1"><span class="c2">Recall that our desired signal frequency range is 1.7~3.0Hz. Optional hardware RC filtering can filter out high frequency noise if the cutoff frequency for a low pass filter is set to ~3Hz. We did not elect to do so - we opted for analog filtering on the Arduino - but these two methods do not conflict with each other so both can be implemented simultaneously for the best results.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">Also, the power supplies can be replaced by a battery pack, but make sure resistance and capacitance values are still valid.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c15 c16">Component B: Beat Detection to Pulse Formation</span></p><p class="c1"><span>Final code that we ended up using can be found </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=https://docs.google.com/document/d/1vl_KAqjY3bfIHfhBH_WR0udrtXtov9cGyww6AbVTuOc/edit?usp%3Dsharing&amp;sa=D&amp;ust=1538149707841000">here</a></span><span>. The input signal undergoes a bass filtering, envelope filtering, and then low pass (3.0Hz cutoff) filtering process before analysis. All of this filter code was taken from the LED belt tutorial which can be found </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=http://damian.pecke.tt/beat-detection-on-the-arduino&amp;sa=D&amp;ust=1538149707841000">here</a></span><span class="c2">. The Arduino is instructed to make a detection every 200 ms. The detection checks if the state of the signal has changed from low to high. If so, it marks the time and waits until the next low to high interval to find the beat. The threshold between what is considered as low versus high is determined by a resistor-potentiometer divider to allow for physical adjustment without re-uploading code (we used 1k&#8486; resistor-10k~100k&#8486; pot divider). This output of this divider is plugged into the A1 slot of the arduino. Based upon the beat time interval detected by the low to high change, all servos move accordingly from 0&deg; to 90&deg;.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c16 c15">Best troubleshooting method for Arduino code</span></p><p class="c1 c4"><span class="c2">Throughout implementing the code it is best to be able to see what is successful and not. This is easily done by having the oscilloscope CH1 connected to amplification circuit output (which is the Arduino input) and CH2 connected to Digital Pin 2. </span></p><p class="c1 c6 c4"><span class="c2"></span></p><p class="c1 c4"><span class="c2">It is important to utilize print statements for debugging (don&rsquo;t forget Serial.begin), however keep in mind that print statements slow down the loop process. Creating too many print statements may lead to more issues than if there were none if things are very time dependant. </span></p><p class="c1 c6 c4"><span class="c2"></span></p><p class="c1 c4"><span class="c2">It is important to check that variables are defined in the same way if information is being passed from one to the next. (Example: integer = float; will make information incorrect)</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c16 c15">Optional Enhancements</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">If one is interested it making the signal for the beat detection very stable such that random noise (ex a loud clap) doesn&rsquo;t influence the way the narwal dances, one could write code to alleviate this issue. In case the signal is inconsistent meaning that the beat detection isn&rsquo;t consistent (this would be seen on the oscilloscope) you can incorporate a way to calculate the median amongst the past 10 numbers. This would involve creating an array and using quicksort method to find the median.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As of right now the narwal doesn&rsquo;t do a great job of stopping after dancing, and the program continues to run after a song is completed. A good way to do this is to create a break code that would set all of the servos to the resting position of 0&deg; after the song has completed. </span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1 c4"><span class="c2">Finally, you can incorporate more dance moves and utilize a random generator to decide when to use which dance move</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c16 c12">Component C: Structural Design</span></p><p class="c1"><span>Schematic for structural design: </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 356.00px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 356.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c18">There are two seperate motor controlled sections that create the overall movement of the robot: </span></p><p class="c1"><span class="c2">The lower section is a spinning and rising disk that uses a pin-in-hole mechanism to stabilize itself while also moving freely around the axis. The motion is powered by four circularly facing servo motors (face same direction in a circular pattern) that are permanently attached to the bottom half of the CD case forming the foundation of the robot. The equidistant placement of the servos on the bottom platform is important to obtain a balanced and smooth vertical and spinning motion. When the servos work in unison it results in a rotation and lifting of the mobile disk. The stationary purple disk was hot glued to the cardboard and the servos were placed and hot glued in their specific locations. All four servos used the one sided extenders pictured here:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 55.00px; height: 63.00px;"><img alt="" src="images/image6.png" style="width: 71.00px; height: 63.00px; margin-left: -16.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2">A layer of cardboard was placed between the servo and the mobile plastic CD case in order to improve stability. The structure that formed the hole for the pin was made from a brass fastener head facing down with its two tails wrapped around a tight wire ring made from a paperclip. The head of the fastener was glued to the bottom layer of cardboard. The pin was made from the rest of the paper clip and attached to the mobile purple disk.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 468.00px;"><img alt="" src="images/image8.png" style="width: 624.00px; height: 468.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>The upper section creates a tilting motion that is powered by two servo motors which move a </span><span class="c11"><a class="c8" href="https://www.google.com/url?q=https://www.thingiverse.com/thing:2156713&amp;sa=D&amp;ust=1538149707844000">3D printed</a></span><span>&nbsp;joystick mechanism, reffered to sometimes as the double rainbow, (largest size was 57 mm). The joystick mechanism was printed out of ABS, Acylonitrile Butadiene Styrene</span><span class="c22">,</span><span class="c2">&nbsp;with dissolvable supports that were removed by placing the print in a lye bath overnight. We discovered the effectiveness of dissolvable supports after the first two prints failed. They were using PLA with and without undissolvable supports. It was concluded that dissolvable supports and ABS would be the most effective way to print the joystick mechanism. Even with dissolvable supports the lye bath couldn&rsquo;t get to all of the dissolvable support out of the very small spaces between joints. It took a lot of extra effort to make sure that the print was free of supports so that the joint could move freely and smoothly. Once we were sure that the print was effective we started to figure out how to connect the two servos to the joystick mechanism. After attempting to use heat shrink, hot glue and screwed wood and failing, Larry and I developed a double ended screw method. First, I drilled 0.750 mm drill bit sized holes (one per a servo connection point with a 0.750 drill bit) into the center of the two cross shaped connection points (where we will connect the 2 servos later) using a drill press. Then I used a 0.80 mm tap and driver to make ridges inside the 0.750 drilled hole. Once the ridges were made, I screwed in the 0.80 mm screws as far as they could go. I then measured how deep the screw could twist onto the servo (this was a very short distance &lt; 1 mm). The distance that the screw would go into the servo is the length sticking out of the joystick that I marked and then cut so that the servos would fit tightly against the joystick connectors. I had to tap the servos before screwing in the 0.80 mm screws as well. This double-ended screw apparatus was reinforced with epoxy glue because it was crucial that the servo rotations move the joystick connectors and not the body of the servo motor itself. After attaching the servos to the joystick mechanism it was time to mount the joystick. A chipboard platform with holes cut out on the bottom for the free movement of the rotating poles and double rainbow were laser printed and 4 mounting holes were drilled with the drill press. The 2&rdquo; 8/32 screws were placed through the joystick&rsquo;s mounting holes, through a washer (for space and extra joystick mobility), and finally through the mounting holes in the chipboard, and 1.5&rdquo; 8/32 standoffs were screwed on below the chipboard to support it and the ends were hot glued to the purple platform. The presence of the chipboard under the servos kept them stable and supported The servos were hot glued to the chipboard in their appropriate places. </span></p><p class="c1 c4"><span class="c2">The brown, red, and orange pins of a servo must be connected to ground, power, and an arduino pin capable of pulse width modulation (pwm), respectively. If you choose to include more than 6 servos in your design, keep in mind that the Arduino Uno only has 6 digital pins capable of pulse width modulation (marked on the board with &ldquo;~&rdquo;). Furthermore, we are already powering the servos with an external breadboard as the Arduino Uno cannot handle that level of current demand.</span></p><p class="c1 c4"><span class="c2">The Dancing Narwhal itself was sculpted out of foam core using a foam cutter (a hot wire that is held taut and burns through foam leaving a smooth cut finish). The eyes and mouth of the Narwhal were improvised from salvaged stuffed animal facial features. The horn of the Narwhal was crafted from wikki stix and spray painted silver. It was assembled in an improvised rush but turned out pretty cute if I don&rsquo;t say so myself (I built it ;D). Please feel free to instill the ability to dance upon your own spirit animal.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c16 c12">Optional Enhancements</span></p><p class="c1"><span class="c2">The joystick structure that we 3D-printed is not capable of a large range of motion. For fluid motion, when one servo is moving, the other must be held at the center position. When both servos are moving simultaneously, the joystick is able to move across the diagonal, but if one servo is moving and the other is held at an angle, the joystick will be stuck. The 3D-printing of this joystick required removable supports in order to print in place and have compact mobile joint.</span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1 c6"><span class="c2"></span></p><p class="c1"><span class="c5">Project Timeline</span></p><p class="c1"><span class="c2">Dependent on how ambitious you want to be - rather, the extent to which your ambitions differ from ours - the amount of time required to complete this project will vary. The project timeline will also depend on your available resources. If you follow our comprehensive documentation step-by-step and have all the materials on hand, this is an easy project for an afternoon (not including the time needed for 3D-printing the joystick and soaking the dissolvable supports in a lye bath overnight) because we&rsquo;ve already done the grunt work for you. If you want to make any enhancements to the beat filtering and detection Arduino code, keep in mind our troubleshooting tips to save your sanity. Hope you have fun constructing the dancing spirit animal of your choice! The (functioning) final product is truly a rewarding companion. </span></p><p class="c0"><span class="c2">&#426;(&#728;&#8995;&#728;)&#9488; &#426;(&#728;&#8995;&#728;)&#643; &#9484;(&#728;&#8995;&#728;)&#643;</span></p><p class="c1 c6"><span class="c2"></span></p></body></html>